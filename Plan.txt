# Plan: React-based Emby Web Client

Build a modern, clean React web application for Emby that authenticates users with persistent credentials, displays latest movies/shows on a homepage, enables library browsing, and supports direct streaming with multi-version file selection.

## Steps

1. **Set up React + TypeScript project** with Vite, React Router for routes (/login, /home, /library/:id, /player/:id), and organize into folders: components (Login, Home, Library, Player, MediaSelector), services (embyApi, auth), hooks (useAuth, useEmbyData), and types (emby.types.ts for API interfaces)

2. **Implement authentication** in [Login.tsx](Login.tsx) with form for server URL/port/username/password stored in localStorage, calling `/Users/Public` then `/Users/AuthenticateByName`, storing AccessToken and building authorization headers (`X-Emby-Token` + `Authorization: Emby UserId=...`) for all subsequent requests in [embyApi.ts](embyApi.ts)

3. **Create homepage** in [Home.tsx](Home.tsx) fetching latest movies (`/Items/Latest?IncludeItemTypes=Movie`), latest episodes (`/Items/Latest?IncludeItemTypes=Episode`), and resumable items (`/Items?Filters=IsResumable`), displaying in horizontal scrollable rows with poster images using `/Items/{Id}/Images/Primary?MaxWidth=300`

4. **Build library browser** in [Library.tsx](Library.tsx) fetching user views (`/Users/{UserId}/Views`) to show all movie/TV libraries, then drilling into selected library with `/Users/{UserId}/Items?ParentId={id}&Recursive=true&IncludeItemTypes=Movie,Series` displaying in responsive grid with search/filter

5. **Implement media version selector** in [MediaSelector.tsx](MediaSelector.tsx) component calling `POST /Items/{Id}/PlaybackInfo` to get all MediaSources, displaying each with resolution (Width×Height), codec, file size, bitrate, and audio info from MediaStreams array for user selection

6. **Create video player** in [Player.tsx](Player.tsx) using HTML5 video element with selected MediaSourceId to construct URL `/Videos/{Id}/stream?Static=true&MediaSourceId={id}&PlaySessionId={sessionId}`, with standard controls and back navigation

## Further Considerations

1. **Multi-version UI placement** - Should version selection appear before playback (modal on item click), or as button during playback? A pre-playback modal is cleaner for explicit choice.

2. **Library filtering** - Should the library browser support filtering by genre, year, rating, or sorting options? This improves UX for large collections.

3. **Episode browsing** - For TV shows, do you want season/episode navigation with thumbnails, or a simple list view? Card-based season selectors are more modern.

## Technical Details

### Authentication Flow
- Store server URL, port, username, password in localStorage
- Authorization header format: `Authorization: Emby UserId="xxx", Client="Web", Device="Chrome", DeviceId="unique-device-id", Version="1.0.0"`
- After authentication, add `X-Emby-Token: {AccessToken}` to all requests
- Handle 401 responses by redirecting to login

### Key API Endpoints
- **Login**: `POST /Users/AuthenticateByName` with body `{ "pw": "password" }`
- **User Views**: `GET /Users/{UserId}/Views`
- **Latest Items**: `GET /Users/{UserId}/Items/Latest?IncludeItemTypes=Movie&Limit=20`
- **Library Items**: `GET /Users/{UserId}/Items?ParentId={id}&Recursive=true`
- **PlaybackInfo**: `POST /Items/{Id}/PlaybackInfo` (returns MediaSources and PlaySessionId)
- **Direct Stream**: `GET /Videos/{Id}/stream?Static=true&MediaSourceId={id}&PlaySessionId={sessionId}`
- **Images**: `GET /Items/{Id}/Images/Primary?MaxWidth=300&Tag={imageTag}`

### MediaSource Selection
When multiple video files exist for a single movie/show:
1. Call `POST /Items/{Id}/PlaybackInfo` to get all MediaSources
2. Display each option with:
   - Resolution (from MediaStreams video Width×Height)
   - Codec (H264, HEVC, etc.)
   - File size (format MediaSource.Size to GB/MB)
   - Bitrate (format MediaSource.Bitrate to Mbps)
   - Audio info (channels, codec from MediaStreams audio)
3. User selects preferred version
4. Use MediaSource.Id as MediaSourceId parameter in stream URL
5. Use PlaySessionId from PlaybackInfo response

### Project Structure
```
src/
├── components/
│   ├── Login.tsx
│   ├── Home.tsx
│   ├── Library.tsx
│   ├── Player.tsx
│   └── MediaSelector.tsx
├── services/
│   ├── embyApi.ts
│   └── auth.ts
├── hooks/
│   ├── useAuth.ts
│   └── useEmbyData.ts
├── types/
│   └── emby.types.ts
├── App.tsx
└── main.tsx
```

### Styling Approach
- Use TailwindCSS or Material-UI for modern, clean design
- Dark theme by default (common for media applications)
- Card-based layouts for media items
- Horizontal scrollable rows for featured content
- Responsive grid for library browsing
- Smooth transitions and hover effects
